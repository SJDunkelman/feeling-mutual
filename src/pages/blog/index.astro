---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Section from '../../components/Section.astro';
import NavigationBar from '../../components/NavigationBar.astro';
import Footer from '../../components/Footer.astro';
import GetInTouch from '../../components/GetInTouch.astro';

const allPosts = await getCollection('blog');
const sortedPosts = allPosts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

// Get unique categories
const categories = [...new Set(allPosts.map(post => post.data.category))];

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
}

function truncateText(text: string, maxLength: number): string {
  if (text.length <= maxLength) return text;
  return text.substring(0, maxLength) + '...';
}
---

<Layout title="Blog | Feeling Mutual">
  <Section class="bg-offwhite py-6 xl:py-16">
    <NavigationBar logoColour="maroon" />

    <div class="py-8">
      <h1 class="text-5xl font-semibold text-gold mb-4">Blog</h1>
      <p class="text-lg text-gold font-light">Insights and thoughts on online qualitative research</p>

      <!-- Category Pills -->
      <div class="flex flex-wrap gap-2 mt-6">
        {categories.map(category => (
          <a href={`/category/${category}`} class="px-4 py-2 bg-blue text-offwhite rounded-full text-sm hover:bg-blue/75">
            {category.charAt(0).toUpperCase() + category.slice(1).replace('-', ' ')}
          </a>
        ))}
      </div>
    </div>

    <!-- Blog Posts Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 py-8">
      {sortedPosts.map(post => (
        <a href={`/blog/${post.slug}`} class="group">
          <div class="bg-white rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-shadow">
            {post.data.showcaseImage && (
              <img
                src={`/content/blog/${post.slug}/${post.data.showcaseImage}`}
                alt={post.data.title}
                class="w-full h-48 object-cover"
              />
            )}
            <div class="p-4">
              <p class="text-sm text-gold/75 mb-2">{formatDate(post.data.date)}</p>
              <h3 class="text-xl font-semibold text-maroon group-hover:text-tomato transition-colors">
                {post.data.title}
              </h3>
              <p class="text-gold font-light mt-2">{truncateText(post.data.description, 100)}</p>
              <p class="text-tomato mt-4 font-medium">Read More <i class="fa-solid fa-arrow-right-long"></i></p>
            </div>
          </div>
        </a>
      ))}
    </div>
  </Section>

  <Section class="bg-maroon py-6">
    <GetInTouch textColour="offwhite" />
    <Footer textColour="offwhite" />
  </Section>
</Layout>
