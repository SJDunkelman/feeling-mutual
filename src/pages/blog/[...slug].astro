---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Section from '../../components/Section.astro';
import NavigationBar from '../../components/NavigationBar.astro';
import Footer from '../../components/Footer.astro';
import GetInTouch from '../../components/GetInTouch.astro';
import ActionBanner from '../../components/ActionBanner.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
}

const categoryDisplay = post.data.category.charAt(0).toUpperCase() + post.data.category.slice(1).replace('-', ' ');
---

<Layout title={`${post.data.title} | Feeling Mutual`} description={post.data.description}>
  <Section class="bg-maroon text-pink">
    <NavigationBar helloButton />
    <div class="flex mobile-only:flex-col flex-row py-6">
      <div class="w-full">
        <div class="flex flex-wrap mb-6 lg:pt-10 md:flex-col text-sandybrown">
          <div class="flex items-center justify-start mb-8">
            <div class="flex items-center text-xs text-pink font-semibold">
              <a href="/">Home</a>
              <span class="inline-block px-1">/</span>
              <a href="/blog">Blog</a>
              <span class="inline-block px-1">/</span>
              <a href={`/category/${post.data.category}`}>{categoryDisplay}</a>
            </div>
          </div>
          <h1 class="mb-10 text-5xl font-semibold text-center lg:text-left">{post.data.title}</h1>
          <div class="flex items-center justify-start">
            <div class="mr-6">
              <img class="w-16 h-16 object-cover rounded-full" src="/images/tom_profile.jpg" alt="Tom Woodnutt" />
            </div>
            <div class="text-left">
              <h3 class="text-2xl font-semibold font-heading">Tom Woodnutt</h3>
              <p class="opacity-75 font-light">Founder, Feeling Mutual</p>
              <p class="font-extralight">{formatDate(post.data.date)}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </Section>

  <Section class="bg-offwhite py-8">
    <div class="post-body prose prose-lg max-w-none">
      <Content />
    </div>
  </Section>

  <Section class="bg-blue py-6">
    {post.data.category === 'article' ? (
      <GetInTouch textColour="white" buttonColour="pink" />
    ) : (
      <ActionBanner textColour="pink" />
    )}
    <Footer textColour="pink" logoColour="maroon" />
  </Section>
</Layout>

<style>
  .post-body :global(h1) {
    @apply text-2xl font-semibold mb-4;
  }
  .post-body :global(h2) {
    @apply text-xl font-semibold mb-3;
  }
  .post-body :global(p) {
    @apply text-lg font-light text-justify leading-8 mb-4;
  }
  .post-body :global(ul) {
    @apply list-disc list-inside text-lg font-light leading-8 mb-4;
  }
  .post-body :global(ol) {
    @apply list-decimal list-inside text-lg font-light leading-8 mb-4;
  }
  .post-body :global(a) {
    @apply text-tomato underline hover:text-maroon;
  }
  .post-body :global(img) {
    @apply my-4 rounded-lg;
  }
</style>
